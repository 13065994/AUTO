<!DOCTYPE html>
<html lang="en">

<head>
    <title>Automation Messenger Bot</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            padding: 20px;
            background-color: #f8f9fa;
            font-family: 'Arial', sans-serif;
        }

        .container {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-top: 20px;
            margin-bottom: 20px; 
        }

        h1 {
            color: #343a40;
        }

        label {
            color: #495057;
        }

        .centered-textarea {
            display: block;
            margin: 0 auto;
            width: 100%;
            min-height: 150px;
            padding: 10px;
            box-sizing: border-box;
            border: 1px solid #ced4da;
            border-radius: 5px;
            resize: none;
        }

        .btn-primary {
            background-color: #007bff;
            border: 1px solid #007bff;
        }

        .btn-primary:hover {
            background-color: #0056b3;
            border: 1px solid #0056b3;
        }

        .success-message {
            color: green;
            margin-top: 10px;
        }

        .footer {
            background-color: rgba(255, 255, 255, 0.7);
            padding: 10px;
            text-align: center;
            font-size: 16px;
            color: #555;
            margin-top: 50px;
            border-top: 1px solid #ccc;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
        }

        .footer p {
            margin: 0;
            display: inline-block;
            margin-right: 30px;
        }

        .container-buttons {
            margin-top: 20px;
            text-align: center;
        }

        .container-buttons .btn {
            margin: 5px;
        }

        #user_online {
            margin-top: 20px;
        }

        .user-card {
            border: 1px solid #ced4da;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
        }

      #result {
   
          padding: 10px;
          margin-top: 20px;
          border-radius: 5px;
      }

     

    </style>
</head>

<body>
    <div class="container">
        <form id="json-form" onsubmit="submitForm(event)">
            <div class="form-group">
                <textarea id="json-data" class="form-control centered-textarea" placeholder=""></textarea>
            </div>
        </form>
  
    </div>

   <div id="result" class="container text-center" style="display: none;"></div>


     
    <div class="container container-buttons mt-5">
        <div class="row">
            <div class="col text-center">
                <button class="btn btn-primary" onclick="State()">Submit</button>
            </div>
        </div>
    </div>

  <div class="container">
      <div class="row">
          <h1 class="col text-start" style="margin-left: 12px; font-size: 20px; ">Current Online:</h1>
      </div>
      <div class="row" id="user_online">
      
      </div>
  </div>


  <div class="container">
     <h1 class="col text-center" style="font-size: 20px;">Source code</h1>
    <h1 class="col text-center" style="font-size: 20px;"></h1>
  </div>


   </div>

    <div class="footer">
        <p>Time: <span id="time"></span></p>
        <p>Ping: <span id="ping"></span></p>
    </div>
  

    <script>
        function measurePing() {
            var xhr = new XMLHttpRequest();
            var startTime, endTime;

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    endTime = Date.now();
                    var pingTime = endTime - startTime;
                    document.getElementById("ping").textContent = pingTime + " ms";
                }
            };

            xhr.open("GET", location.href + "?t=" + new Date().getTime());
            startTime = Date.now();
            xhr.send();
        }
        setInterval(measurePing, 1000);

        function updateTime() {
            const now = new Date();
            const options = { timeZone: 'Asia/Manila', hour12: true, hour: 'numeric', minute: 'numeric', second: 'numeric' };
            const formattedTime = now.toLocaleString('en-US', options);
            document.getElementById('time').textContent = formattedTime;
        }
        updateTime();
        setInterval(updateTime, 1000);

        function submitForm(event) {
            event.preventDefault();
            State();
        }

      async function State() {
          const json = document.getElementById('json-data').value;

          try {
              const State = JSON.parse(json);

              const response = await fetch('/login', {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json',
                  },
                  body: JSON.stringify({ app: State }),
              });

              const data = await response.json();

             if (data.success) {
                 showResult(data.message);
             } else {
                 showResult(data.message);
             }
         
          } catch (parseError) {
              console.error('Error parsing JSON:', parseError);
              showResult(parseError);
          }
      }

      function showResult(message) {
          const resultContainer = document.getElementById('result');
          resultContainer.innerHTML = `<h5>${message}</h5>`;
          resultContainer.style.display = 'block'; 
      }


      async function listOfAi() {
          const userOnline = document.getElementById("user_online");

          try {
              const response = await fetch("/info");
              const data = await response.json();

              userOnline.innerHTML = ''; 

              data.forEach(user => {
                  const { name, thumbSrc, profileUrl } = user;

                  const userCard = document.createElement('div');
                  userCard.className = 'col-md-4 user-card mb-4 text-center';

                  const imageContainer = document.createElement('div');
                  imageContainer.className = 'mb-3';

                  const image = document.createElement('img');
                  image.src = thumbSrc;
                  image.alt = 'User Thumbnail';
                  image.className = 'img-thumbnail';

                  const userName = document.createElement('h4');
                  userName.textContent = name;
                  userName.className = 'mb-2';

                  const line = document.createElement('hr');
                  line.className = 'mb-2';

                  const profileLink = document.createElement('p');
                  profileLink.innerHTML = `${profileUrl}`;

                  imageContainer.appendChild(image);
                  userCard.appendChild(imageContainer);
                  userCard.appendChild(userName);
                  userCard.appendChild(line);
                  userCard.appendChild(profileLink);

                  userOnline.appendChild(userCard);
              });
          } catch (error) {
              console.error(error);
              userOnline.innerHTML = `<div class="alert alert-danger" role="alert">An error occurred while fetching data.</div>`;
          }
      }


       listOfAi();



    </script>
  
</body>
</html>
